<!DOCTYPE html><html lang="en"><head>
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com;
        connect-src 'self' https://text.pollinations.ai;
        frame-src 'self' blob: https://www.youtube.com https://trytako.com;
        child-src 'self';
        manifest-src 'self';
        worker-src 'self';
        upgrade-insecure-requests;
        block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy App</title>
    <link rel="icon" type="image/x-icon" href="icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #111111;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #111111;
        }

        /* Title Bar */
        .title-bar {
            background: #1a1a1a;
            backdrop-filter: blur(20px);
            padding: 16px 24px;
            border-bottom: 1px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            position: relative;
        }

        .title-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .title {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.025em;
        }

        .aeromechanic-btn {
            background: #333333;
            color: #ffffff;
            border: 1px solid #555555;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .aeromechanic-btn:hover {
            background: #444444;
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .title-right {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .icon-btn {
            background: #222222;
            border: 1px solid #333333;
            color: #ffffff;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .icon-btn:hover {
            background: #333333;
            transform: translateY(-1px);
        }

        .icon-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Dropdown Menu */
        .menu-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            min-width: 200px;
            z-index: 1001;
            opacity: 0;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            overflow: hidden;
        }

        .menu-dropdown.open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .menu-item {
            padding: 16px 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
            font-weight: 500;
        }

        .menu-item:hover {
            background: #333333;
        }

        .menu-item svg {
            width: 18px;
            height: 18px;
            opacity: 0.7;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: #1a1a1a;
            border-right: 1px solid #333333;
            display: flex;
            flex-direction: column;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        .sidebar.hidden {
            width: 0;
            border-right: none;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid #333333;
        }

        .new-chat-btn {
            background: #333333;
            color: #ffffff;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .new-chat-btn:hover {
            background: #444444;
            transform: translateY(-1px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .new-chat-btn svg {
            width: 16px;
            height: 16px;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .chat-item {
            padding: 16px 20px;
            margin: 4px 0;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #cccccc;
            font-weight: 500;
        }

        .chat-item:hover {
            background: #333333;
            color: #ffffff;
        }

        .chat-item.active {
            background: #333333;
            border-left-color: #666666;
            color: #ffffff;
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #ffffff;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            background: #ffffff;
        }

        .message {
            max-width: 85%;
            word-wrap: break-word;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            background: #000000;
            color: #ffffff;
            padding: 16px 20px;
            border-radius: 20px 20px 6px 20px;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .message.assistant {
            align-self: flex-start;
            background: #f8f9fa;
            color: #1a1a1a;
            padding: 20px 24px;
            border-radius: 20px 20px 20px 6px;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            line-height: 1.6;
        }

        .welcome-prompt {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            text-align: center;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: #666666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .app-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .suggestion-btn {
            background: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            color: #1a1a1a;
        }

        .suggestion-btn:hover {
            border-color: #666666;
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .code-block {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 16px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 100%;
        }

        .code-header {
            background: #222222;
            padding: 16px 24px;
            border-bottom: 1px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #ffffff;
            font-weight: 600;
        }

        .code-language {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #cccccc;
        }

        .code-actions {
            display: flex;
            gap: 8px;
        }

        .code-content {
            padding: 24px;
            overflow-x: auto;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e6e6e6;
            background: #1a1a1a;
        }

        .code-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-btn {
            background: #333333;
            color: #ffffff;
            border: 1px solid #555555;
            padding: 6px 12px;  /* Reduced from 8px 16px */
            border-radius: 6px;  /* Reduced from 8px */
            cursor: pointer;
            font-size: 11px;     /* Reduced from 12px */
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;            /* Reduced from 6px */
            height: 28px;        /* Add fixed height */
        }

        .code-btn:hover {
            background: #444444;
            color: #ffffff;
        }

        .code-btn.preview-btn {
            background: #555555;
        }

        .code-btn.preview-btn:hover {
            background: #666666;
        }

        .code-btn svg {
            width: 12px;
            height: 12px;
        }

        /* Input Area */
        .input-area {
            padding: 24px 32px 32px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 16px;
            align-items: flex-end;
            background: #ffffff;
        }

        .input-container {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            background: #ffffff;
            color: #1a1a1a;
            border: 1px solid #e9ecef;
            border-radius: 16px;
            padding: 16px 60px 16px 20px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            max-height: 120px;
            min-height: 52px;
            line-height: 1.5;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .message-input:focus {
            outline: none;
            border-color: #666666;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .message-input::placeholder {
            color: #999999;
        }

        .send-btn {
            position: absolute;
            right: 8px;
            bottom: 8px;
            background: #333333;
            color: #ffffff;
            border: none;
            padding: 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 36px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .send-btn:hover:not(:disabled) {
            background: #444444;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .send-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Preview Area */
        .preview-area {
            width: 0;
            background: #ffffff;
            border-left: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .preview-area.open {
            width: 60%;
        }

        .preview-header {
            background: #f8f9fa;
            padding: 16px 24px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-title {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px;
        }

        .preview-actions {
            display: flex;
            gap: 8px;
        }

        .preview-content {
            flex: 1;
            overflow: hidden;
            background: #ffffff;
            position: relative;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #ffffff;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #cccccc;
            border-radius: 50%;
            border-top-color: #333333;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #000000;
            color: #ffffff;
            padding: 12px 16px;
            border-radius: 12px;
            margin: 12px 0;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .retry-btn {
            background: #333333;
            color: #ffffff;
            border: 1px solid #555555;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .retry-btn:hover {
            background: #444444;
        }

        /* Scrollbar Styling */
        .chat-area::-webkit-scrollbar,
        .chat-history::-webkit-scrollbar,
        .preview-content::-webkit-scrollbar {
            width: 6px;
        }

        .chat-area::-webkit-scrollbar-track,
        .chat-history::-webkit-scrollbar-track,
        .preview-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .preview-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                height: 100%;
                z-index: 100;
                width: 280px;
            }

            .sidebar.hidden {
                width: 0;
                transform: translateX(-100%);
            }
            
            .message {
                max-width: 95%;
            }
            
            .preview-area.open {
                width: 100%;
            }

            .title-bar {
                padding: 16px 20px;
            }

            .title {
                font-size: 18px;
            }

            .input-area {
                padding: 20px;
            }

            .chat-area {
                padding: 24px 20px;
            }

            .app-suggestions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="title-left">
                <div class="title">Easy App</div>
                <a href="https://aeromechanic.fun" class="aeromechanic-btn" target="_blank">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    <span>aeromechanic</span>
                </a>
            </div>
            <div class="title-right">
                <button class="icon-btn" onclick="toggleSidebar()" title="Toggle Project History">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <button class="icon-btn" onclick="toggleMenu()" title="Menu">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="1"></circle>
                        <circle cx="12" cy="5" r="1"></circle>
                        <circle cx="12" cy="19" r="1"></circle>
                    </svg>
                </button>
                
                <!-- Dropdown Menu -->
                <div class="menu-dropdown" id="menuDropdown">
                    <div class="menu-item" onclick="exportChat()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7,10 12,15 17,10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        <span>Export Project</span>
                    </div>
                    <div class="menu-item" onclick="clearAllChats()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3,6 5,6 21,6"></polyline>
                            <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                        </svg>
                        <span>Clear All Projects</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <button class="new-chat-btn" onclick="newChat()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        New Webpage Project
                    </button>
                </div>
                <div class="chat-history" id="chatHistory">
                    <div class="chat-item active" onclick="selectChat(this)">
                        Welcome - Webpage Ideas
                    </div>
                </div>
            </div>

            <!-- Chat Container -->
            <div class="chat-container">
                <div class="chat-area" id="chatArea">
                    <div class="message assistant">
                        <div class="welcome-prompt">
                            <div class="welcome-title">🚀 Welcome to Easy App!</div>
                            <div class="welcome-subtitle">
                                Create beautiful, professional webpages in seconds! Perfect for events, personal projects, and quick promotional sites.
                            </div>
                            <div class="app-suggestions">
                                <div class="suggestion-btn" onclick="selectAppType('event')">
                                    🎉 Event Webpage
                                </div>
                                <div class="suggestion-btn" onclick="selectAppType('blog')">
                                    📝 Personal Blog
                                </div>
                                <div class="suggestion-btn" onclick="selectAppType('profile')">
                                    👤 Personal Profile
                                </div>
                                <div class="suggestion-btn" onclick="selectAppType('product')">
                                    📦 Product Introduction
                                </div>
                                <div class="suggestion-btn" onclick="selectAppType('landing')">
                                    🎯 Landing Page
                                </div>
                                <div class="suggestion-btn" onclick="selectAppType('custom')">
                                    💡 Something Else
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-container">
                        <textarea class="message-input" id="messageInput" placeholder="Describe your webpage idea... (Enter to send, Shift+Enter for new line)" onkeydown="handleKeyDown(event)"></textarea>
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="preview-area" id="previewArea">
                <div class="preview-header">
                    <span class="preview-title" id="previewTitle">Webpage Preview</span>
                    <div class="preview-actions">
                        <button class="code-btn" onclick="downloadPreview()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Download
                        </button>
                        <button class="code-btn" onclick="closePreview()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                            Close
                        </button>
                    </div>
                </div>
                <div class="preview-content">
                    <iframe class="preview-iframe" id="previewIframe" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentChat = 'Welcome - Webpage Ideas';
        let chats = {
            'Welcome - Webpage Ideas': [
                { role: 'assistant', content: 'WELCOME_MESSAGE' }
            ]
        };
        let isLoading = false;
        let currentPreviewContent = '';
        let currentPreviewType = '';

        function selectAppType(type) {
            const suggestions = {
                'event': 'I want to create an event webpage for a conference/workshop/party. Include event details, schedule, speakers, location, and registration information.',
                'blog': 'I want to create a personal blog webpage with multiple articles, categories, and a clean reading experience.',
                'profile': 'I want to create a personal profile webpage showcasing my skills, experience, portfolio, and contact information.',
                'product': 'I want to create a product introduction webpage that highlights features, benefits, pricing, and testimonials.',
                'landing': 'I want to create a landing page for marketing purposes with compelling headlines, features, and call-to-action buttons.',
                'custom': 'I have a custom webpage idea that I\'d like to discuss...'
            };
            
            const input = document.getElementById('messageInput');
            input.value = suggestions[type];
            input.focus();
        }

        function toggleMenu() {
            const dropdown = document.getElementById('menuDropdown');
            dropdown.classList.toggle('open');
            
            // Close menu when clicking outside
            document.addEventListener('click', function closeMenuHandler(e) {
                if (!e.target.closest('.title-right')) {
                    dropdown.classList.remove('open');
                    document.removeEventListener('click', closeMenuHandler);
                }
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }

        function exportChat() {
            document.getElementById('menuDropdown').classList.remove('open');
            
            if (!chats[currentChat] || chats[currentChat].length === 0) {
                alert('No project to export!');
                return;
            }

            let exportText = `Easy App Export: ${currentChat}\n`;
            exportText += `Exported on: ${new Date().toLocaleString()}\n`;
            exportText += `Created with Easy App - AI-powered webpage builder\n\n`;
            exportText += '='.repeat(50) + '\n\n';

            chats[currentChat].forEach((message, index) => {
                if (message.content !== 'WELCOME_MESSAGE') {
                    exportText += `${message.role.toUpperCase()}: ${message.content}\n\n`;
                }
            });

            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `easy_app_export_${currentChat.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function clearAllChats() {
            document.getElementById('menuDropdown').classList.remove('open');
            
            if (confirm('Are you sure you want to clear all webpage projects? This action cannot be undone.')) {
                chats = {};
                const chatHistory = document.getElementById('chatHistory');
                chatHistory.innerHTML = '';
                newChat();
            }
        }

        function newChat() {
            const chatName = 'New Webpage Project ' + Object.keys(chats).length;
            chats[chatName] = [
                { role: 'assistant', content: 'WELCOME_MESSAGE' }
            ];
            addChatToHistory(chatName);
            selectChatByName(chatName);
        }

        function addChatToHistory(chatName) {
            const chatHistory = document.getElementById('chatHistory');
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.textContent = chatName;
            chatItem.onclick = function() { selectChat(chatItem); };
            chatHistory.appendChild(chatItem);
        }

        function selectChat(element) {
            document.querySelectorAll('.chat-item').forEach(function(item) {
                item.classList.remove('active');
            });
            element.classList.add('active');
            currentChat = element.textContent;
            loadChatMessages();
        }

        function selectChatByName(chatName) {
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(function(item) {
                if (item.textContent === chatName) {
                    selectChat(item);
                }
            });
        }

        function loadChatMessages() {
            const chatArea = document.getElementById('chatArea');
            chatArea.innerHTML = '';
            
            if (chats[currentChat]) {
                chats[currentChat].forEach(function(message) {
                    if (message.content === 'WELCOME_MESSAGE') {
                        addWelcomeMessage();
                    } else {
                        addMessageToChat(message.role, message.content, false);
                    }
                });
            }
        }

        function addWelcomeMessage() {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant';
            messageDiv.innerHTML = `
                <div class="welcome-prompt">
                    <div class="welcome-title">🚀 Welcome to Easy App!</div>
                    <div class="welcome-subtitle">
                        Create beautiful, professional webpages in seconds! Perfect for events, personal projects, and quick promotional sites.
                    </div>
                    <div class="app-suggestions">
                        <div class="suggestion-btn" onclick="selectAppType('event')">
                            🎉 Event Webpage
                        </div>
                        <div class="suggestion-btn" onclick="selectAppType('blog')">
                            📝 Personal Blog
                        </div>
                        <div class="suggestion-btn" onclick="selectAppType('profile')">
                            👤 Personal Profile
                        </div>
                        <div class="suggestion-btn" onclick="selectAppType('product')">
                            📦 Product Introduction
                        </div>
                        <div class="suggestion-btn" onclick="selectAppType('landing')">
                            🎯 Landing Page
                        </div>
                        <div class="suggestion-btn" onclick="selectAppType('custom')">
                            💡 Something Else
                        </div>
                    </div>
                </div>
            `;
            chatArea.appendChild(messageDiv);
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter') {
                if (event.shiftKey) {
                    // Shift+Enter: Allow line break (default textarea behavior)
                    return;
                } else {
                    // Enter: Send message
                    event.preventDefault();
                    sendMessage();
                }
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isLoading) return;

            input.value = '';
            input.style.height = 'auto'; // Reset height
            addMessageToChat('user', message);
            
            if (!chats[currentChat]) {
                chats[currentChat] = [];
            }
            
            chats[currentChat].push({ role: 'user', content: message });

            // Update chat name if it's a new project
            if (chats[currentChat].length === 2) { // Welcome message + first user message
                updateChatName(message);
            }

            isLoading = true;
            updateSendButton();

            try {
                // Enhanced prompt for webpage generation
                const enhancedPrompt = `You are Easy App's AI assistant - a powerful webpage builder. The user wants to create a webpage. When generating code, remember to:

1. Create a single HTML file with embedded React code using CDN imports
2. Use modern and elegant UI design principles
3. Include proper React hooks and best practices
4. Make the webpage responsive and accessible
5. Add beautiful styling with CSS-in-JS or embedded CSS
6. Include interactive features and smooth animations
7. Make the webpage fully functional and production-ready
8. Focus on clean, professional designs suitable for short-term use

User request: ${message}

The webpage should be written in a single HTML file with React JS for modern and elegant UI design. Make it beautiful, interactive, and fully functional.`;

                const response = await callPollinationsAI(enhancedPrompt);
                addMessageToChat('assistant', response);
                chats[currentChat].push({ role: 'assistant', content: response });
            } catch (error) {
                console.error('Error calling Pollinations AI:', error);
                addErrorMessage('Failed to generate your webpage. Please try again.', message);
            } finally {
                isLoading = false;
                updateSendButton();
            }
        }

        async function callPollinationsAI(prompt) {
            try {
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const textResponse = await response.text();
                return textResponse || 'Sorry, I couldn\'t generate your webpage. Please try again.';
            } catch (error) {
                console.error('Pollinations AI Error:', error);
                throw error;
            }
        }

        function updateChatName(firstMessage) {
            const chatItems = document.querySelectorAll('.chat-item');
            const activeItem = document.querySelector('.chat-item.active');
            if (activeItem && (activeItem.textContent.startsWith('New Webpage Project') || activeItem.textContent.startsWith('Welcome'))) {
                const shortName = firstMessage.length > 25 ? firstMessage.substring(0, 25) + '...' : firstMessage;
                activeItem.textContent = shortName;
                currentChat = shortName;
            }
        }

        function addErrorMessage(errorText, originalMessage) {
            const chatArea = document.getElementById('chatArea');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'message assistant';
            errorDiv.innerHTML = `
                <div class="error-message">
                    <span>${errorText}</span>
                    <button class="retry-btn" onclick="retryMessage('${originalMessage.replace(/'/g, "\\'")}')">Retry</button>
                </div>
            `;
            chatArea.appendChild(errorDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function retryMessage(message) {
            isLoading = true;
            updateSendButton();

            try {
                const enhancedPrompt = `You are Easy App's AI assistant - a powerful webpage builder. The user wants to create a webpage. When generating code, remember to:

1. Create a single HTML file with embedded React code using CDN imports
2. Use modern and elegant UI design principles
3. Include proper React hooks and best practices
4. Make the webpage responsive and accessible
5. Add beautiful styling with CSS-in-JS or embedded CSS
6. Include interactive features and smooth animations
7. Make the webpage fully functional and production-ready
8. Focus on clean, professional designs suitable for short-term use

User request: ${message}

The webpage should be written in a single HTML file with React JS for modern and elegant UI design. Make it beautiful, interactive, and fully functional.`;

                const response = await callPollinationsAI(enhancedPrompt);
                addMessageToChat('assistant', response);
                chats[currentChat].push({ role: 'assistant', content: response });
            } catch (error) {
                console.error('Retry error:', error);
                addErrorMessage('Still unable to generate your webpage. Please check your connection.', message);
            } finally {
                isLoading = false;
                updateSendButton();
            }
        }

        function updateSendButton() {
            const sendBtn = document.getElementById('sendBtn');
            if (isLoading) {
                sendBtn.innerHTML = '<div class="loading"></div>';
                sendBtn.disabled = true;
            } else {
                sendBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                    </svg>
                `;
                sendBtn.disabled = false;
            }
        }

        function addMessageToChat(role, content, saveToHistory) {
            if (saveToHistory === undefined) saveToHistory = true;
            
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + role;

            if (role === 'assistant') {
                const processedContent = processCodeBlocks(content);
                messageDiv.innerHTML = processedContent;
            } else {
                messageDiv.textContent = content;
            }

            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function processCodeBlocks(content) {
            const codeBlockRegex = /```(\w+)?\n?([\s\S]*?)```/g;
            let processedContent = content;
            let match;

            while ((match = codeBlockRegex.exec(content)) !== null) {
                const language = match[1] || 'text';
                const code = match[2].trim();
                const codeBlockHtml = createCodeBlock(language, code);
                processedContent = processedContent.replace(match[0], codeBlockHtml);
            }

            processedContent = processedContent.replace(/`([^`]+)`/g, '<code style="background: #f5f5f5; padding: 3px 6px; border-radius: 4px; font-family: monospace; color: #333333; font-size: 13px;">$1</code>');
            processedContent = processedContent.replace(/\n/g, '<br>');

            return processedContent;
        }

        function createCodeBlock(language, code) {
            const blockId = 'code_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const canPreview = language === 'html' && code.includes('<!DOCTYPE html');
            
            return `<div class="code-block">
                <div class="code-header">
                    <div class="code-language">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;">
                            <polyline points="16,18 22,12 16,6"/>
                            <polyline points="8,6 2,12 8,18"/>
                        </svg>
                        ${language.toUpperCase()}
                    </div>
                    <div class="code-actions">
                        <button class="code-btn" onclick="copyCode('${blockId}')">
                            Copy
                        </button>
                        ${canPreview ? `<button class="code-btn preview-btn" onclick="previewCode('${blockId}', '${language}')">
                            Live Preview
                        </button>` : ''}
                    </div>
                </div>
                <div class="code-content">
                    <pre id="${blockId}">${escapeHtml(code)}</pre>
                </div>
            </div>`;
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function copyCode(blockId) {
            const codeElement = document.getElementById(blockId);
            const code = codeElement.textContent;
            
            navigator.clipboard.writeText(code).then(function() {
                const copyBtn = codeElement.closest('.code-block').querySelector('.code-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>
                    Copied!
                `;
                setTimeout(function() {
                    copyBtn.innerHTML = originalHTML;
                }, 2000);
            });
        }

        function previewCode(blockId, language) {
            const codeElement = document.getElementById(blockId);
            const code = codeElement.textContent;
            
            currentPreviewContent = code;
            currentPreviewType = language;
            
            const previewArea = document.getElementById('previewArea');
            const previewIframe = document.getElementById('previewIframe');
            const previewTitle = document.getElementById('previewTitle');
            const sidebar = document.getElementById('sidebar');
            
            sidebar.classList.add('hidden');
            previewArea.classList.add('open');
            previewTitle.textContent = 'Webpage Preview';
            
            // Create blob URL for the HTML content
            const blob = new Blob([code], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            // Set iframe src to the blob URL
            previewIframe.src = url;
            
            // Clean up the blob URL after a delay
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 1000);
        }

        function closePreview() {
            const previewArea = document.getElementById('previewArea');
            const sidebar = document.getElementById('sidebar');
            
            previewArea.classList.remove('open');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('hidden');
            }
        }

        function downloadPreview() {
            if (!currentPreviewContent) return;
            
            const blob = new Blob([currentPreviewContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'easy-app-webpage.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Auto-resize textarea
        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').focus();
        });
    </script>



</body></html>